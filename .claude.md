# Claude Code Instructions for UnitHub

> âš ï¸ **IMPORTANT**: Always read relevant documentation before starting any task.

---

## ğŸ“š Required Reading Before Tasks

### For ANY Task
1. **Check `docs/README.md`** first to find relevant documentation
2. **Review related docs** before making changes
3. **Follow established patterns** from existing code

### For Testing Tasks
**MUST READ**: [`docs/testing-roadmap.md`](./docs/testing-roadmap.md) - Your complete testing guide

Key sections:
- Current Status (line 11)
- Quick Start Guide (line 42)
- Running Tests (line 74)
- Getting Help (line 915)
- Test Checklist (line 956)

Supporting docs:
- [`docs/testing-best-practices.md`](./docs/testing-best-practices.md) - How to write tests
- [`docs/testing-implementation.md`](./docs/testing-implementation.md) - Technical setup & issues

### For Feature Development
**READ FIRST**:
- [`docs/project-vision.md`](./docs/project-vision.md) - Project goals and target market
- [`docs/project-summary.md`](./docs/project-summary.md) - What's been built
- [`docs/ai-features.md`](./docs/ai-features.md) - AI feature plans

### For Payment/Integration Features
**READ**: [`docs/payment-integration.md`](./docs/payment-integration.md) - Bank payment tracking plans

### For Database/Server Actions
**READ**:
- [`docs/complete-database-integration.md`](./docs/complete-database-integration.md)
- Existing server actions in `app/actions/` for patterns

---

## ğŸ¯ Task-Specific Guidelines

### Writing Tests
1. **Read** `docs/testing-roadmap.md` - Quick Start Guide section
2. **Check** which phase the test belongs to
3. **Review** existing tests in `app/actions/__tests__/` or `components/**/__tests__/`
4. **Follow** patterns from `docs/testing-best-practices.md`
5. **Run** tests to verify: `npm test -- path/to/test.ts`

**Test Structure Requirements**:
- Co-located in `__tests__/` directories
- Use descriptive names: `should [behavior] when [condition]`
- Mock external dependencies (Supabase, Next.js)
- Test both happy path and error cases

### Adding New Features
1. **Verify** feature is in project vision/roadmap
2. **Review** similar existing features for patterns
3. **Create tests FIRST** (TDD approach preferred)
4. **Follow** existing code structure:
   - Server actions in `app/actions/`
   - Components in `components/`
   - Pages in `app/`
5. **Write tests** for new code (aim for 70%+ coverage)

### Fixing Bugs
1. **Reproduce** the issue
2. **Check** if tests exist for the buggy code
3. **Write failing test** that demonstrates the bug
4. **Fix** the code
5. **Verify** test passes
6. **Check** no other tests broke

### Refactoring
1. **Ensure tests exist** for code being refactored
2. **Run tests** before starting: `npm test`
3. **Refactor** incrementally
4. **Run tests** after each change
5. **Verify** all tests still pass: `npm test`

### Documentation Updates
1. **Check** if related docs exist in `docs/`
2. **Update** all affected documentation files
3. **Keep** cross-references accurate
4. **Follow** existing documentation format

---

## ğŸ—ï¸ Project Structure

```
UnitHub/
â”œâ”€â”€ app/                          # Next.js app router
â”‚   â”œâ”€â”€ actions/                  # Server actions (business logic)
â”‚   â”‚   â”œâ”€â”€ __tests__/           # Server action tests âœ…
â”‚   â”‚   â”œâ”€â”€ tenants.ts
â”‚   â”‚   â”œâ”€â”€ rent.ts
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”œâ”€â”€ api/                      # API routes
â”‚   â”‚   â””â”€â”€ ai/                  # AI feature endpoints âš ï¸ UNTESTED
â”‚   â””â”€â”€ [pages]/                 # Page components âš ï¸ UNTESTED
â”‚
â”œâ”€â”€ components/                   # React components
â”‚   â”œâ”€â”€ [feature]/               # Feature-grouped components
â”‚   â”‚   â”œâ”€â”€ __tests__/           # Component tests
â”‚   â”‚   â””â”€â”€ *.tsx
â”‚   â””â”€â”€ ui/                      # shadcn/ui components
â”‚
â”œâ”€â”€ lib/                         # Utilities and configs
â”‚   â”œâ”€â”€ supabase/               # Supabase client
â”‚   â”œâ”€â”€ schemas.ts              # Zod validation schemas
â”‚   â””â”€â”€ types.ts                # TypeScript types
â”‚
â”œâ”€â”€ docs/                        # Documentation (READ FIRST!)
â”‚   â”œâ”€â”€ README.md               # Documentation index â­
â”‚   â”œâ”€â”€ testing-roadmap.md      # Complete testing guide â­
â”‚   â””â”€â”€ ...
â”‚
â””â”€â”€ tests/                       # Integration & E2E tests (future)
```

---

## âœ… Code Quality Checklist

Before completing any task, verify:

### For All Code Changes
- [ ] Read relevant documentation
- [ ] Followed existing code patterns
- [ ] TypeScript types are correct
- [ ] No console.errors or console.logs (use proper error handling)
- [ ] No eslint warnings introduced

### For New Features
- [ ] Tests written FIRST (TDD)
- [ ] Server action tests (if applicable)
- [ ] Component tests (if applicable)
- [ ] Page tests (if applicable)
- [ ] Integration test plan (if complex workflow)
- [ ] Coverage doesn't decrease
- [ ] Documentation updated

### For Bug Fixes
- [ ] Test reproduces the bug
- [ ] Test passes after fix
- [ ] No regressions (all tests pass)
- [ ] Root cause understood

### For Tests
- [ ] Follows patterns from `docs/testing-best-practices.md`
- [ ] Co-located with code being tested
- [ ] Tests behavior, not implementation
- [ ] Both happy path and error cases covered
- [ ] Mocks are properly scoped
- [ ] Test names are descriptive
- [ ] All tests pass: `npm test`

---

## ğŸš« Common Mistakes to Avoid

### Don't Skip Documentation
âŒ **Wrong**: Jump into coding without reading docs
âœ… **Right**: Check `docs/README.md` â†’ Read relevant docs â†’ Code

### Don't Guess Patterns
âŒ **Wrong**: Guess how to structure tests or components
âœ… **Right**: Look at existing examples in the codebase

### Don't Break Tests
âŒ **Wrong**: Push code that makes tests fail
âœ… **Right**: Run `npm test` before and after changes

### Don't Write Tests After
âŒ **Wrong**: Write code first, tests later (or never)
âœ… **Right**: Write tests first (TDD), or immediately after

### Don't Ignore Coverage
âŒ **Wrong**: Only test happy paths
âœ… **Right**: Test errors, edge cases, validation

### Don't Create New Patterns
âŒ **Wrong**: Invent new file structures or naming conventions
âœ… **Right**: Follow existing patterns in the codebase

---

## ğŸ“Š Current Test Status

**Overall Coverage**: 12% (Target: 60-70%)

**What's Tested** âœ…:
- Server actions: 60-74% (30 tests)
- Component tests: 23 tests passing (but 0% counted)

**What Needs Testing** âŒ:
- AI API routes (0%)
- Page components (0%)
- Untested components (0%)
- Integration tests (none)
- E2E tests (none)

**Priority**: Fix component coverage tracking, then test AI routes

See [`docs/testing-roadmap.md`](./docs/testing-roadmap.md) for complete plan.

---

## ğŸ”§ Development Commands

```bash
# Testing
npm test                          # Run all tests
npm test -- path/to/test         # Run specific test
npm run test:watch               # Run tests in watch mode
npm run test:coverage            # Run with coverage report

# Development
npm run dev                      # Start dev server
npm run build                    # Build for production
npm run lint                     # Run linter

# Coverage Report
npm run test:coverage            # Generate coverage
# Then open: coverage/lcov-report/index.html
```

---

## ğŸ“ Key Principles

1. **Documentation First**: Always read docs before coding
2. **Test-Driven**: Write tests first, or immediately after
3. **Follow Patterns**: Look at existing code for examples
4. **Type Safety**: Use TypeScript properly, no `any`
5. **Error Handling**: Handle errors gracefully, no silent failures
6. **Co-located Tests**: Tests live next to the code they test
7. **Behavior Testing**: Test what code does, not how it does it
8. **Incremental Changes**: Small commits, frequent testing

---

## ğŸ†˜ When Stuck

1. **Check Documentation**: `docs/README.md` or `docs/testing-roadmap.md`
2. **Look for Examples**: Similar code in the codebase
3. **Review Test Patterns**: `docs/testing-best-practices.md`
4. **Check Known Issues**: `docs/testing-implementation.md`
5. **Read Error Messages**: They usually tell you what's wrong

---

## ğŸ“ Documentation Maintenance

When creating/modifying documentation:
- Keep cross-references updated
- Use relative links: `[text](./other-doc.md)`
- Update "Last Updated" dates
- Add to `docs/README.md` index if new doc
- Keep table of contents in sync

---

## ğŸ¯ Current Priorities

Based on [`docs/testing-roadmap.md`](./docs/testing-roadmap.md):

**Phase 1 - This Week** (1-2 days):
1. Fix component coverage tracking
2. Un-mock RentChart
3. Create test helpers

**Phase 2 - This Month** (1 week):
1. Test AI API routes â­ (competitive advantage)
2. Test page components
3. Test untested components

**See roadmap for complete plan.**

---

## ğŸ¤ Contribution Guidelines

1. **Always run tests**: `npm test` before committing
2. **Write descriptive commit messages**: Explain what and why
3. **Keep coverage up**: Don't decrease test coverage
4. **Document changes**: Update relevant docs
5. **Follow conventions**: Match existing code style
6. **Review checklist**: Complete relevant checklist above

---

**Remember**: This is a property management app for small landlords managing 10-50 units. Every feature should serve that target user. AI features are our competitive advantage - test them thoroughly!

**Last Updated**: 2025-10-31
